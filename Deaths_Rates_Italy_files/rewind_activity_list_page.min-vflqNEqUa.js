define(["require","exports","tslib","react","modules/core/i18n","modules/clean/react/delorean/data/types","modules/clean/react/delorean/components/folder_history/folder_history","modules/clean/react/delorean/data/actions","modules/clean/react/delorean/components/rewind_step_header","modules/clean/react/delorean/components/rewind_continue_widget","modules/clean/react/trash/constants","modules/clean/react/delorean/logging","modules/clean/react/delorean/constants","modules/clean/react/delorean/util"],function(e,t,o,s,n,r,i,a,d,p,c,l,v,u){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),s=o.__importDefault(s),l=o.__importStar(l);var h=(function(e){function t(t){var s=e.call(this,t)||this;return s.initialEventTimestamp=null,s.startLoadTsInMs=null,s.loadPageOfEvents=function(){var e=s.props,t=e.user,n=e.restoreId,i=e.events;s.setState(function(e){var a=e.pagesLoaded+1;if(2===a&&(l.loadEvents({user:t,restoreId:n,startLoadTsInMs:s.startLoadTsInMs,events:i}),s.props.events.type===r.RewindEventState.hasContent))for(var d=0,p=s.props.events.processedEvents;d<p.length;d++){var c=p[d];if(c.type===r.DeloreanEventType.event){s.initialEventTimestamp=c.timestamp;break}}return o.__assign({},e,{pagesLoaded:a})})},s.onGoBack=function(){var e=s.props,t=e.user,o=e.restoreId;l.clickEventsBack({user:t,restoreId:o}),s.props.dispatch({type:r.DeloreanActionType.goBackFromActivityListPage})},s.showMoreFuture=function(e){var t=Date.now();s.props.dispatch(a.showMoreAction({user:s.props.user,fqpath:s.props.browseContext.currentFQPath,futureCursor:e,direction:r.PaginationDirection.future,done:function(e){var o=s.props,n=o.user,r=o.restoreId;l.clickEventsLoadNew({user:n,restoreId:r,startTsInMs:t,count:e})}}))},s.showMorePast=function(e){var t=Date.now();s.props.dispatch(a.showMoreAction({user:s.props.user,fqpath:s.props.browseContext.currentFQPath,pastCursor:e,direction:r.PaginationDirection.past,done:function(e){var o=s.props,n=o.user,r=o.restoreId;l.clickEventsLoadNew({user:n,restoreId:r,startTsInMs:t,count:e})}}))},s.selectEventForRewind=function(e){s.setState({eventAboveDivider:e.topEvent,eventBelowDivider:e.botEvent})},s.onContinue=function(){s.state.eventAboveDivider&&s.state.eventBelowDivider&&(s.logContinue(s.state.eventAboveDivider),s.props.dispatch({type:r.DeloreanActionType.changeRewindPageToConfirmationPage,eventAboveDivider:s.state.eventAboveDivider,eventBelowDivider:s.state.eventBelowDivider}))},s.logContinue=function(e){if(s.props.events.type===r.RewindEventState.hasContent){var t=s.initialEventTimestamp,o=s.props,n=o.user,i=o.restoreId,a=s.props.events.processedEvents;l.clickEventsNext({selectedEvent:e,events:a,restoreId:i,initialEventTimestamp:t,user:n})}},s.state={pagesLoaded:0,eventAboveDivider:void 0,eventBelowDivider:void 0},s}return o.__extends(t,e),t.prototype.componentDidMount=function(){this.startLoadTsInMs=Date.now(),this.props.dispatch({type:r.DeloreanActionType.clearEventList});var e=Math.floor((this.props.selectedDateTsInMs+c.ONE_DAY_MS)/1e3);this.props.dispatch(a.fetchEventsAction({user:this.props.user,fqpath:this.props.fqpath,onlyRewindableEvents:!0,direction:r.PaginationDirection.past,timestampInSeconds:e,done:this.loadPageOfEvents})),this.props.dispatch(a.fetchEventsAction({user:this.props.user,fqpath:this.props.fqpath,direction:r.PaginationDirection.future,onlyRewindableEvents:!0,timestampInSeconds:e,done:this.loadPageOfEvents}))},t.prototype.render=function(){return s.default.createElement("div",{className:"folder-history-ie11fix"},s.default.createElement("div",{className:"folder-history-event-list-container"},this.props.isForRewindFlow&&s.default.createElement(d.RewindStepHeader,{currentStep:2,maxStep:v.NUM_REWIND_STEPS,instructions:n._("Fine tune",{project:"folder-history"}),onGoBack:this.onGoBack}),s.default.createElement(i.FolderHistory,{selectedDateTsInMs:this.props.selectedDateTsInMs,dispatch:this.props.dispatch,events:this.props.events,isForARewind:this.props.isForRewindFlow,onShowMoreFuture:this.showMoreFuture,onShowMorePast:this.showMorePast,onClickEvent:this.props.isForRewindFlow?this.selectEventForRewind:u.noop,pagesLoaded:this.state.pagesLoaded}),s.default.createElement(p.RewindContinueWidget,{onContinue:this.onContinue,visible:!!this.state.eventBelowDivider&&!!this.state.eventAboveDivider,text:n._("Now, letâ€™s review",{project:"folder-history",comment:"Try to keep this as short as possible"})})))},t})(s.default.Component);t.RewindActivityListPage=h});
//# sourceMappingURL=rewind_activity_list_page.min.js-vflAAXvG_.map