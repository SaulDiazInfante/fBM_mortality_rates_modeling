define("modules/clean/animation",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.quadraticBezierPointsAtPercent=function(e,t,n,r){return{x:Math.pow(1-r,2)*e.x+2*(1-r)*r*t.x+Math.pow(r,2)*n.x,y:Math.pow(1-r,2)*e.y+2*(1-r)*r*t.y+Math.pow(r,2)*n.y}};var n=(function(){function e(e,t){var n=this;this.start=function(){n.isRunning=!0;var e=n.thunk,t=n.fps,r=-1,a=-1,i=1e3/t,o=function(e,t){var n=Date.now(),r=n-(t||0);return r>i&&(e(),t=n-r%i),a=requestAnimationFrame(function(){return o(e,t)})};r=requestAnimationFrame(function(){return o(e)}),n.cleanup=function(){cancelAnimationFrame(r),cancelAnimationFrame(a)}},this.stop=function(){n.isRunning=!1,n.cleanup()},this.thunk=e,this.fps=t,this.cleanup=function(){},this.isRunning=!1}return e})();t.RenderAtFps=n}),define("modules/clean/invitations",["require","exports","tslib","modules/core/notify","modules/clean/ajax","modules/core/exception","modules/core/i18n"],function(e,t,n,r,a,i,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),a=n.__importStar(a),i=n.__importStar(i),t.SendInvitations=function(e,t,n,s,c){if(!(e.trim().split("/[;,s]+/").length&&""!==e.trim()||t&&""!==t.trim()))return void r.Notify.error(o._("Please choose at least one contact."));var l={emails:e,referral_src:s};void 0!==t&&null!==t&&t&&void 0!==n&&null!==n&&(l.fb_ids=t,l.fb_link=n);var u="/send_invite";return a.WebRequest({url:u,type:"POST",data:l,success:function(e){c?c(e.substr(5)):r.Notify.success(e.substr(5))},error:function(e){if(200!==e.status)return r.Notify.error(o._("There was a problem completing this request.")),i.reportStack("The server communicated a status of "+e.status+" when posting to "+u+" with an\n          error message of "+e.statusText,{severity:i.SEVERITY.CRITICAL,tags:[""+e.status]})}}),!1}}),define("modules/clean/react/referrals/referrals_hero",["require","exports","tslib","react","modules/clean/animation"],function(e,t,n,r,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),r=n.__importDefault(r);var i=(function(e){function t(t){var r=e.call(this,t)||this;return r.state=n.__assign({actors:[],canvas:null,ctx:null,end:0,fps:60,id:""},r.state),r.drawImage=function(e,t,n,r){void 0===n&&(n=0),void 0===r&&(r=0);var a=new Image;e&&a.addEventListener("load",function(){e.drawImage(a,n,r)},!1),a.src=t},r.rocket=function(e){var t=0,n={x:e.start.x,y:e.start.y},i=new Image,o=0,s="up",c=function(){if(r.state.ctx&&r.state.canvas){r.state.ctx.clearRect(0,0,r.state.canvas.width,r.state.canvas.height);var e=n.x,t=n.y;o===2*r.state.fps&&(s="down"),0===o&&(s="up"),"down"===s?o--:o++,t+=.1*o,r.state.ctx.drawImage(i,e-75,t-75),setTimeout(function(){requestAnimationFrame(c)},1e3/r.state.fps)}},l=function(t){r.state.ctx&&r.state.canvas&&(r.state.ctx.clearRect(0,0,r.state.canvas.width,r.state.canvas.height),t<=r.state.end&&(n=a.quadraticBezierPointsAtPercent({x:e.start.x,y:e.start.y},{x:e.mid.x,y:e.mid.y},{x:e.end.x,y:e.end.y},t/100),n.x=n.x+(2*Math.random()+1),r.state.ctx.drawImage(i,n.x-75,n.y-75)))},u=function(){t+=1.2,t>=r.state.end?setTimeout(function(){return c(),!1},750):(l(t),setTimeout(function(){requestAnimationFrame(u)},1e3/r.state.fps))};i.addEventListener("load",function(){u()},!1),i.src=e.path},r}return n.__extends(t,e),t.prototype.componentDidMount=function(){var e=this,t={_rocket:this.rocket},n=document.getElementById(this.props.id),r=n&&n.getContext("2d")||null,a=this.props.actors.map(function(e){return JSON.parse(e)});this.setState({actors:a,currentBonus:this.props.currentBonus,maxBonus:this.props.maxBonus,canvas:n,ctx:r,end:this.props.currentBonus/this.props.maxBonus*100,fps:this.props.fps,id:this.props.id,static:this.props.static,staticHero:this.props.staticHero,endState:this.props.endState}),this.props.static?this.drawImage(r,this.props.staticHero,0,0):this.props.currentBonus<this.props.maxBonus?a.map(function(n){t[n.animationFunction]?t[n.animationFunction](n):e.drawImage(r,n.path,n.start.x,n.start.y)}):this.drawImage(r,this.props.endState,0,0)},t.prototype.render=function(){var e={};return!this.state.static&&this.state.currentBonus<this.state.maxBonus&&(e.backgroundImage="url("+this.props.stage+")"),r.default.createElement("canvas",{className:this.props.className,id:this.props.id,height:this.props.height,width:this.props.width,style:e})},t.defaultProps={actors:[],currentBonus:0,maxBonus:32,fps:60,id:"",height:313,width:864},t})(r.default.Component);t.ReferralsHero=i}),define("modules/clean/react/referrals/referrals_tokenizer",["require","exports","tslib","modules/core/i18n","modules/clean/react/button","modules/clean/account/email","modules/clean/web_timing_logger","modules/clean/contacts/tokenizer","modules/clean/account/email_verify_reasons","modules/clean/invitations","modules/core/notify","react","modules/clean/viewer","modules/clean/analytics"],function(e,t,n,r,a,i,o,s,c,l,u,f,d,m){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),i=n.__importStar(i),o=n.__importStar(o),c=n.__importStar(c),f=n.__importDefault(f);var _=d.Viewer.get_viewer(),p=_.get_users()[0],h=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.getTokenizerReference=function(e){t.tokenizerReference=e},t._onClick=function(){var e=t.tokenizerReference.getContacts().filter(function(e){return!e.invalid}).map(function(e){return e.email});return m.WebMiscActivityLogger.log("refer_click_send_emails",{num_recipients:e.length}),i.EmailVerification.get_for_user(p).verified_or_send_and_show(c.REFER_FRIENDS,l.SendInvitations(e.join(";"),"","","referrals_bulk9",function(e){u.Notify.success(e)}))},t}return n.__extends(t,e),t.prototype.componentDidMount=function(){o.mark_time_to_interactive()},t.prototype.render=function(){return f.default.createElement("div",{className:"tokenizer-container"},f.default.createElement("div",{className:"tokenizer-object"},f.default.createElement(s.ContactsTokenizer,{placeholder:r._("Names or email addresses"),ref:this.getTokenizerReference,user:p,showContactImport:!0,shouldLogContactSearch:!0,context:"referrals"})),f.default.createElement(a.Button,{className:"tokenizer-button",onClick:this._onClick},r._("Send")))},t})(f.default.Component);t.ReferralsTokenizer=h}),define("modules/clean/referral_contact_refresh",["require","exports","tslib","jquery","nouislider","modules/clean/ajax","modules/clean/dbmodal","modules/core/exception","modules/core/notify","modules/clean/viewer","modules/core/i18n","modules/clean/invitations","modules/clean/analytics"],function(e,t,n,r,a,i,o,s,c,l,u,f,d){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),r=n.__importDefault(r),a=n.__importStar(a),i=n.__importStar(i),o=n.__importStar(o),s=n.__importStar(s);var m=(function(){function e(e,t,n,m){var _=this;this.get_selected_emails=function(){var e=r.default("#contact-list input:checked.email"),t=[];return e&&(t=r.default.map(e,function(e){return r.default(e).val()})),t},this.get_selected_fb_contacts=function(){var e=r.default("#contact-list input:checked.fb"),t=[];return e&&(t=r.default.map(e,function(e){return r.default(e).val()})),t},this.show_contact_list_modal=function(){r.default("#contact-list").empty(),r.default("#free-space-slider").hide(),r.default("#select-contacts-submit-button").text(u._("Invite friends")),r.default("#contact-import-spinner").show(),new o.DBModal({element_id:"select-contacts-modal",title:u._("Invite friends and family to Dropbox!")}).show();var e="/contacts/get_imported_checklist";return i.WebProgressRequest({url:e,subject_user:l.Viewer.get_viewer().personal_user,success:function(e,t){r.default("#contact-list").html(e),_.show_contacts(),_.eventHandlers(),_.spaceSlider()},error:function(t){s.reportStack("The server communicated a status of "+t.status+" when retrieving data from "+e,{severity:s.SEVERITY.CRITICAL,tags:[""+t.status]}),_.show_contacts()}})},this.show_contacts=function(){r.default("#contact-import-spinner").hide(),0===r.default(".contact-row").length&&new o.DBModal({element_id:"no-contact-list-modal",title:u._("Oops! No contacts here.")}).show(),l.Viewer.get_viewer().team_id||r.default("#free-space-slider").show(),_.contactRows=r.default("#contact-list .contact-row");for(var e=0,t=_.contactRows.length;e<t;e++){var n=_.contactRows[e];n.search_text=r.default(n).find(".contact-name").first().html()+r.default(n).find(".contact-email").first().html()}_.update_invite_count(),_.select_all(!0),_.select_first(24)},this.select_first=function(e){r.default("#contact-list input.email").not(":disabled").slice(0,e).prop("checked",!0),_.update_invite_count()},this.select_all=function(e){_.selectAllActive=!e&&!_.selectAllActive;var t=_.selectAllActive?u._("Select None"):u._("Select All");if(r.default("#contact-select-all").text(t),!e){var n=r.default("#contact-list input.email:visible").not(":disabled");_.selectAllActive&&(n=n.slice(0,450)),n.each(function(e,t){r.default(t).prop("checked",_.selectAllActive)}),_.update_invite_count()}},this.update_invite_count=function(){var e,t=r.default(".contact-row").removeClass("selected").has("input:checked").addClass("selected"),n=t.length,a=Math.min(n*_.bonusPerReferral,_.maxReferralBonus),i=document.getElementById("free-space-slider-track");if(i&&i.noUiSlider){var o=a||0;i.noUiSlider.set(o);var s=r.default("#free-space-slider-track .noUi-handle");s.css("margin-left",-s.outerWidth()*o/_.maxReferralBonus+"px");var c=o/_.maxReferralBonus*100+"%";s.css("left",c)}r.default("#free-space-slider-track .noUi-handle").text(u._("%(potential_gb)f GB").format({potential_gb:a})),e=n?u.ungettext("Invite %(count)d friend","Invite %(count)d friends",n,{comment:"Button"}).format({count:n}):u._("Invite friends",{comment:"Button"}),r.default("#select-contacts-submit-button").text(e)},this.filter=function(e){if(e!==_.lastSearch&&(null!=_.lastSearch||""!==e)){_.lastSearch=e,(null!=_.lastSearch?_.lastSearch.length:void 0)?r.default("#contact-list .contact-header").hide():r.default("#contact-list .contact-header").show();for(var t=0,n=new RegExp(e.trim().split(/[;,\s]+/).join(".*"),"i"),a=0,i=_.contactRows.length;a<i;a++){var o=_.contactRows[a],s=o.style;o.search_text&&(n.test(o.search_text)?(t+=1,s.display=""):s.display="none")}_.select_all(!0);var c=function(){if(_.lastSearch===e)return d.WebMiscActivityLogger.log("contact_list_search",{search_string:e,rows_shown:t})};setTimeout(c,500),_.update_invite_count()}},this.eventHandlers=function(){return r.default("#contact-filter").on("change",function(e){return _.filter(r.default("#contact-filter").val())}),r.default("#select-contacts-submit-button").on("click",function(){var e=_.get_selected_emails().join(";"),t=_.get_selected_fb_contacts().join(";");f.SendInvitations(e,t,_.fbUrl,_.referralTypeBulk,function(e){c.Notify.success(e)})}),_.selectAllActive=!1,r.default("#contact-select-all").on("click",function(e){e.preventDefault(),_.select_all(!1)}),r.default("#contact-list").on("change",function(){if(_.update_invite_count(),null!=_.lastSearch?_.lastSearch.length:void 0)return d.WebMiscActivityLogger.log("contact_list_search",{search_string:_.lastSearch,clicked:1})})},this.spaceSlider=function(){var e=document.getElementById("free-space-slider-track"),t=_.maxReferralBonus,n=_.bonusPerReferral;e&&(a.create(e,{start:[0],range:{min:[0],max:[t]},step:n,connect:!0}),e.setAttribute("disabled","true")),_.update_invite_count()},this.bonusPerReferral=e,this.maxReferralBonus=t,this.referralTypeBulk=n,this.fbUrl=m}return e})();t.ReferralContactList=m}),define("modules/clean/referral_refresh",["require","exports","tslib","jquery","modules/clean/dbmodal","modules/clean/account/email","modules/clean/account/email_verify_reasons","modules/core/exception","modules/core/notify","modules/clean/profile_services/profile_services_constants","modules/clean/social_share_dialog","modules/clean/viewer","modules/core/i18n","modules/clean/analytics","modules/clean/profile_services/profile_services_link","modules/clean/referral_contact_refresh"],function(e,t,n,r,a,i,o,s,c,l,u,f,d,m,_,p){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),r=n.__importDefault(r),a=n.__importStar(a),i=n.__importStar(i),o=n.__importStar(o),s=n.__importStar(s),l=n.__importDefault(l),u=n.__importDefault(u);var h=(function(){function e(e,t,n,h){var v=this;this.fbURL=e,this.referralTypeBulk=t,this.bonusPerReferral=n,this.maxReferralBonus=h,this.eventHandlers=function(){var e=new a.DBModal({element_id:"copy-link-modal"});r.default("#copy-link--button").on("click",function(t){t.preventDefault(),m.WebMiscActivityLogger.log("refer_click_copy_link"),e.show(),r.default("#global-referral-link").select()})},this.facebookShare=function(){new u.default(".facebook-button",function(){m.WebMiscActivityLogger.log("refer_click_facebook_button")})},this.initBulkInvite=function(){var e=new _.ProfileServicesLinkingHandler,t=new p.ReferralContactList(v.bonusPerReferral,v.maxReferralBonus,v.referralTypeBulk,v.fbURL),n=function(e){if(_.ProfileServicesLinkingHandler.show_import_notifications(e),e.success)return e.verified_profile_email?t.show_contact_list_modal():i.EmailVerification.get_for_user(v.user).verified_or_send_and_show(o.REFER_FRIENDS,t.show_contact_list_modal);s.reportStack("There has been an error connecting to "+v.referralTypeBulk+" from /referrals and\n          retrieving contact information.",{severity:s.SEVERITY.NONCRITICAL,tags:[v.referralTypeBulk+" import error"]});var n=d._("There has been an error connecting to %(referral_type)s").format({referral_type:v.referralTypeBulk});return void c.Notify.error(n)};r.default(".import-yahoo-contacts").on("click",function(){return m.WebMiscActivityLogger.log("refer_click_import_yahoo"),v.user?e.auth_service_with_user(l.default.YAHOO,v.user.id,function(e){return n(e)},"contact-imported-modal"):void 0}),r.default(".import-gmail-contacts").on("click",function(){return m.WebMiscActivityLogger.log("refer_click_import_gmail"),v.user?e.auth_service_with_user(l.default.GOOGLE,v.user.id,function(e){return n(e)},"contact-import-modal"):void 0})},this.user=f.Viewer.get_viewer().personal_user,this.eventHandlers(),this.facebookShare(),this.initBulkInvite()}return e})();t.ReferralsPage=h}),define("modules/clean/social_share_dialog",["require","exports","tslib","jquery"],function(e,t,n,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),r=n.__importDefault(r);var a=(function(){function e(e,t){r.default(e).on("click",function(e){e.preventDefault(),t&&t(),window.open(r.default(this).data("social-href")||r.default(this).attr("href"),"db_share_modal","width=600,height=440,top=400,left=400,resizable,scrollbars=yes,status=1")})}return e})();t.default=a});
//# sourceMappingURL=pkg-legacy-bg.min.js-vflEKqXB6.map