define(["require","exports","tslib","external/classnames","react-redux","react","spectrum/button","spectrum/popover","spectrum/tooltip","spectrum/util/uuid_generator","modules/clean/filepath","modules/clean/filetypes","modules/clean/integrations/data/selectors","modules/clean/react/app_actions/apis","modules/clean/react/app_actions/education/types","modules/clean/react/app_actions/telemetry_client","modules/clean/react/css","modules/clean/react/extensions/connect_flow","modules/clean/react/extensions/data/action_creators","modules/clean/react/extensions/data/selectors","modules/clean/react/extensions/data/store","modules/clean/react/extensions/data/types","modules/clean/react/extensions/tooltips","modules/clean/react/extensions/utils","modules/clean/react/file_viewer/constants","modules/clean/react/file_viewer/file_preview_event_emitter","modules/clean/react/file_viewer/models","modules/clean/react/file_viewer/open_button/types","modules/clean/react/file_viewer_sidebar/buttons/icon","modules/clean/react/portal_popover","modules/clean/static_urls","modules/constants/file_viewer","modules/core/i18n"],function(e,t,n,r,o,i,a,s,l,p,c,u,h,d,_,g,S,v,f,m,T,I,E,P,O,y,A,b,x,C,w,N,L){"use strict";function B(e,t,n){var o=r.default({"extensions-popover-icon":e.type!==b.OpenButtonAction.INVITE_VIA_EMAIL||D||F,"extensions-invite-icon":e.type===b.OpenButtonAction.INVITE_VIA_EMAIL&&!D&&!F});return i.default.createElement(i.default.Fragment,null,i.default.createElement(s.PopoverContentItem,{key:e.text,value:e,className:"app-action-row"},i.default.createElement("div",{className:"app-action-row-content"},i.default.createElement("img",{alt:"",src:w.static_url(t),className:o}),i.default.createElement("span",{className:"app-action-legacy-option-text"},e.text))),n?i.default.createElement(s.PopoverItemGroupSeparator,null):null)}Object.defineProperty(t,"__esModule",{value:!0}),r=n.__importDefault(r),i=n.__importDefault(i);var k="TOOLTIP_ONLY"===N.FILES_2_COLLAPSED_SHARE_COPY_TOOLTIP_CHANGES,D="COPY_ONLY"===N.FILES_2_COLLAPSED_SHARE_COPY_TOOLTIP_CHANGES,F="COPY_AND_TOOLTIP"===N.FILES_2_COLLAPSED_SHARE_COPY_TOOLTIP_CHANGES;T.getStore();var V=(function(e){function t(t){var o=e.call(this,t)||this;return o.handleClickShare=function(e){e.preventDefault(),o.props.onShowShare(),o.currentSession&&o.currentSession.event("click_share",{trigger_type:o.props.triggerType}),e.stopPropagation()},o.handleSelectAction=function(e,t){t.preventDefault(),e.handler(),o.props.logShareButtonClick&&o.props.logShareButtonClick(e.userAction),o.currentSession&&o.currentSession.event("select_action",{type:e.type,trigger_type:o.props.triggerType}),t.stopPropagation()},o.handlePreventMouseDown=function(e){e.preventDefault(),o.state.tooltipState===_.TooltipState.BIG_ONBOARDING_TOOLTIP&&(o.markSplitShareTooltipViewed(),o.setState({tooltipState:_.TooltipState.NO_TOOLTIP})),e.stopPropagation()},o.handlePopoverHover=function(){o.currentSession&&o.currentSession.event("popover_trigger_hover",{trigger_type:o.props.triggerType})},o.handleShareHover=function(){o.currentSession&&o.currentSession.event("share_hover",{trigger_type:o.props.triggerType})},o.handlePopoverToggle=function(e){var t=e.isOpen,n=o.props,r=n.onDropdownOpen,i=n.onDropdownClose,a=n.triggerType,s=n.isCollapsed;if(t&&r?r():!t&&i&&i(),o.currentSession&&o.currentSession.event(t?"open_popover":"close_popover",{trigger_type:a}),t){var l=s?O.EventType.SidebarCollapsedShareClicked:O.EventType.SidebarOpenedShareClicked;y.filePreviewEventEmitter.emit(l,A.FilePreviewSession.currentSession)}},o.handlePresentInZoom=function(e){var t=o.props,n=t.refreshSharingServiceInfo,r=t.sharingServiceInfo,i=t.onPresentInZoom,a=t.landingPageEnabled;r&&n&&i&&v.presentInZoomFlow(e,r,n,i,"split_share_button",a)},o.handleShareInSlack=function(e,t){var n=o.props,r=n.refreshSharingServiceInfo,i=n.sharingServiceInfo,a=n.landingPageEnabled;i&&r&&v.shareInSlackFlow(t,i,r,e,"split_share_button",a)},o.handleShareToTrello=function(e,t){var n=o.props,r=n.refreshSharingServiceInfo,i=n.sharingServiceInfo,a=n.landingPageEnabled;i&&r&&v.shareInTrelloFlow(t,i,r,e,"split_share_button",a)},o.getPopoverTriggerRenderer=function(e,t,n){return function(){var s=D||F?i.default.createElement("img",{alt:"",src:w.static_url("/static/images/extensions/shared_light-vfl8nVEY_.svg")}):i.default.createElement(x.ButtonIcon,{isPrimary:"primary"===o.getButtonVariant(),name:"share","aria-label":n}),p=i.default.createElement(a.Button,{className:r.default("extensions-split-share-menu__trigger",{"extensions-split-share-menu__trigger--collapsed":e}),tagName:"span",tabIndex:t?void 0:-1,variant:o.getButtonVariant(),onMouseEnter:o.handlePopoverHover,"aria-label":L._("Expand share menu")},e?s:"â–¾");return(k||F)&&e?i.default.createElement(l.Tooltip,{positionOffset:8,positioning:"left",tooltipContent:L._("Share")},p):p}},o.getPopoverItemRenderer=function(){return function(){var e=o.props,t=e.user,n=e.file,r=[];return o.getSplitShareOptions(n,t).forEach(function(e){switch(e.type){case b.OpenButtonAction.INVITE_VIA_EMAIL:var t="/static/images/extensions/shared_small-vflTdrLa9.svg",n=!1;(D||F)&&(t="/static/images/logo_catalog/logo_m1-vfl4RBXCG.png",n=!0),r.push(B(e,t,n));break;case b.OpenButtonAction.SHARE_TO_SLACK:r.push(B(e,"/static/images/thirdparty/slack_icon_circle-vfl4S6f-q.svg"));break;case b.OpenButtonAction.PRESENT_IN_ZOOM:r.push(B(e,"/static/images/thirdparty/zoom_icon_transparent_background-vflJC8HYC.svg"));break;case b.OpenButtonAction.SHARE_TO_TRELLO:r.push(B(e,"/static/images/thirdparty/trello_icon-vfl-FetdA.svg"))}}),r}},o.markSplitShareTooltipViewed=function(){d.markTooltipViewed(o.props.user.id,"split_share_edu")},o.state={tooltipState:_.TooltipState.NO_TOOLTIP},o.telemetryClient=g.createTelemetryClient(n.__assign({component:"split-share-btn"},t.context)),o}return n.__extends(t,e),t.prototype.componentDidMount=function(){this.props.showEduTooltip&&this.setEduTooltip()},t.prototype.setEduTooltip=function(){return n.__awaiter(this,void 0,void 0,function(){var e,t,r;return n.__generator(this,function(n){switch(n.label){case 0:return[4,d.getTooltipHistory(this.props.user.id,["open_with_edu","split_share_edu"])];case 1:return e=n.sent(),t=E.allowedTooltips(this.props.appActions.length>0,this.props.file.fq_path?"."+c.file_extension(c.filename(this.props.file.fq_path)):"",this.props.featureFlags),r=t.find(function(t){return void 0!==e[t]&&!e[t]}),"split_share_edu"===r&&this.setState({tooltipState:_.TooltipState.BIG_ONBOARDING_TOOLTIP}),[2]}})})},t.prototype.getSplitShareOptions=function(e,t){var n=this,r=this.props,o=r.featureFlags,i=r.onPresentInZoom,a=r.refreshSharingServiceInfo,s=r.sharingServiceInfo,l=[];if(o.expSplitShareBtn&&"ON_SHOW_INVITE"===o.expSplitShareBtn){var p=D||F?L._("Share with Dropbox"):L._("Invite via email");l.push({handler:this.props.onShowShare,spriteName:null,text:p,type:b.OpenButtonAction.INVITE_VIA_EMAIL,userAction:O.UserAction.InviteViaEmail})}if(!s)return l;P.isSlackAvailable(s)&&!e.is_dir&&l.push({handler:function(){return n.handleShareInSlack(e,t)},spriteName:null,text:L._("Share in Slack"),type:b.OpenButtonAction.SHARE_TO_SLACK,userAction:O.UserAction.ShareToSlack}),P.isTrelloAvailable(s)&&l.push({handler:function(){return n.handleShareToTrello(e,t)},spriteName:null,text:L._("Add to Trello"),type:b.OpenButtonAction.SHARE_TO_TRELLO,userAction:O.UserAction.ShareToTrello});var c=!(e.type!==u.FileTypes.FILE&&e.file_type!==u.FileTypes.FILE||e.is_cloud_doc||e.is_symlink);return P.isZoomAvailable(s)&&i&&a&&c&&!e.is_dir&&l.push({handler:function(){return n.handlePresentInZoom(t)},spriteName:null,text:L._("Present in Zoom"),type:b.OpenButtonAction.PRESENT_IN_ZOOM,userAction:O.UserAction.PresentInZoom}),l},t.prototype.getButtonVariant=function(){var e=this.props,t=e.isVisible,n=e.variant;return n&&t?n:"invisible"},t.prototype.render=function(){var e=this.props,t=e.file,n=e.context,o=e.isVisible,l=e.shareButtonLabel,u=e.triggerType,h=e.isCollapsed,d=e.shouldUsePortalPopover,_=e.scrollableSidebarRef,S=this.props.sharingServiceInfo&&P.shouldShowSplitShare(this.props.featureFlags,this.props.sharingServiceInfo,t);n?this.currentSession=this.telemetryClient.session({ext:g.getPiiSafeExtension(t?"."+c.file_extension(c.filename(t.fq_path)):"")}):delete this.currentSession;var v=r.default({"primary-action-menu__button":u===I.TriggerType.SidebarPrimaryButton,"extensions-inline-share-button":!0}),f=r.default({"primary-action-menu__button":u===I.TriggerType.SidebarPrimaryButton,"action-share":!0}),m=i.default.createElement(a.Button,{"aria-label":l,className:S?v:f,onClick:this.handleClickShare,tabIndex:o?void 0:-1,variant:this.getButtonVariant(),onMouseEnter:this.handleShareHover},l),T=null;if(S){var E=this.getPopoverTriggerRenderer(h,o,l),O=this.getPopoverItemRenderer();if(d){var y=p.generateUUID("popoverId");T=i.default.createElement(C.PortalPopover,{key:y,popoverId:y,className:"extensions-split-share__popover",popoverTriggerSelector:".extensions-split-share-menu__trigger",renderPopoverTrigger:E,renderPopoverItems:O,scrollableContainer:_&&_.current,onSelection:this.handleSelectAction,onMenuToggle:this.handlePopoverToggle,onClick:this.handlePreventMouseDown,onDoubleClick:this.handlePreventMouseDown})}else T=i.default.createElement(s.Popover,{className:"extensions-split-share__popover",onClick:this.handlePreventMouseDown,onDoubleClick:this.handlePreventMouseDown,onSelection:this.handleSelectAction,onMenuToggle:this.handlePopoverToggle,closeOnSelection:!0},i.default.createElement(s.PopoverTrigger,null,E()),i.default.createElement(s.PopoverContent,{position:"below",attachment:"right"},O()))}return i.default.createElement("div",{className:r.default("extensions-split-share-btn",{"extensions-split-share-btn--invisible":!o,"slack-zoom-available":this.props.sharingServiceInfo&&P.isSlackAvailable(this.props.sharingServiceInfo)&&P.isZoomAvailable(this.props.sharingServiceInfo)})},h?null:m,T)},t.defaultProps={isVisible:!0,shareButtonLabel:L._("Share"),triggerType:I.TriggerType.PrimaryButton,variant:"secondary"},t})(i.default.Component);t.SplitShareButtonComponent=V;var R=function(e,t){return{appActions:m.getActionsForFile(e,n.__assign({},t.file,{bytes:0})),featureFlags:m.getFeatureFlags(e),sharingServiceInfo:m.getSharingServiceInfoAdapter(e),landingPageEnabled:h.isConnectServiceLandingPagesEnabled(e)}},M={refreshSharingServiceInfo:f.refreshSharingServiceInfoAdapter},H=o.connect(R,M)(V);t.SplitShareButton=S.requireCssWithComponent(H,["/static/css/extensions/index-vflZE9bW7.css","/static/css/app_actions/index-vfl_lauE_.css"])});
//# sourceMappingURL=split_share_button_component.min.js-vflvHrqz0.map