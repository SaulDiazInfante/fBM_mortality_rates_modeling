define(["require","exports","tslib","modules/clean/api_v2/user_client","modules/clean/react/browse/models","modules/core/i18n","modules/clean/react/snackbar","modules/clean/components/modals/show_modal","modules/clean/react/locked_files/view/modals/lock_confirm_modal","modules/clean/react/locked_files/view/modals/request_unlock_confirm_modal","modules/clean/filepath","modules/core/cookies"],function(e,n,o,t,i,r,s,c,l,a,u,f){"use strict";function m(){return r._("Unlocked editing. Any one else with access can edit again.",{comment:"Message shown when unlocking a file for editing from list on web"})}function d(){return r._("Unlocking editing failed.",{comment:"Error message shown when unlocking a file for editing from list on web"})}function k(e){return{entries:e.map(function(e){return{path:e.fq_path}})}}function _(e){return e.result.then(function(n){return n.entries&&n.entries.length>0&&n.entries.every(function(e){return"success"===e[".tag"]})?(s.Snackbar.complete(e.onSuccessMsg(n),"file-lock-status"),Promise.resolve()):Promise.reject()}).catch(function(){return s.Snackbar.fail(e.onFailMsg,"file-lock-status"),Promise.reject()})}function h(e,n){return o.__awaiter(this,void 0,void 0,function(){var i,s;return o.__generator(this,function(o){switch(o.label){case 0:return i=new t.UserApiV2Client,s=i.ns("files").rpc("lock_file_batch",k(n),{subjectUserId:e}),[4,_({result:s,onSuccessMsg:function(e){return r._("Editing locked. Now only you can make changes.",{comment:"Message shown when locking a file for editing from list on web"})},onFailMsg:r._("Locking editing failed.",{comment:"Error message shown when locking a file for editing from list on web"})})];case 1:return o.sent(),[2]}})})}function g(e,n){return o.__awaiter(this,void 0,void 0,function(){var i,r;return o.__generator(this,function(o){switch(o.label){case 0:return i=new t.UserApiV2Client,r=i.ns("files").rpc("unlock_file_batch",k(n),{subjectUserId:e}),[4,_({result:r,onSuccessMsg:function(e){return m()},onFailMsg:d()})];case 1:return o.sent(),[2]}})})}function w(e,n){return o.__awaiter(this,void 0,void 0,function(){var s,c,l,a;return o.__generator(this,function(o){switch(o.label){case 0:return s=i.File.getFilename(n[0]),c=n[0].lockholder_name,l=new t.UserApiV2Client,a=l.ns("files").rpc("request_unlock_file_batch",k(n),{subjectUserId:e}),[4,_({result:a,onSuccessMsg:function(e){var n=e.entries[0];return n.lock&&n.lock.content&&"unlocked"===n.lock.content[".tag"]?m():r._("Asked %(name)s to unlock %(filename)s",{comment:"Message shown when requesting an unlock of a file from another user on web"}).format({filename:s,name:c})},onFailMsg:r._("Error asking %(name)s to unlock %(filename)s",{comment:"Error message shown when requesting an unlock of a file from another user on web"}).format({filename:s,name:c})})];case 1:return o.sent(),[2]}})})}function b(e,n){var o=function(){h(e,[n])},t=function(){f.Cookies.create("do_not_show_lock_confirmation_dialog","true",365)};"true"===f.Cookies.read("do_not_show_lock_confirmation_dialog")?o():c.showModal(l.FileLockConfirmModal({filename:u.filename(n.fq_path),onLock:o,onNeverShowAgain:t}))}function v(e,n){if(void 0===n.ts_locked||void 0===n.lockholder_name)return void s.Snackbar.fail(r._("Could not ask to unlock. Please try again later.",{comment:"An error message when a user could not ask a user with exclusive edit permissions on a file to give up those permissions. Shown in a snackbar"}),"file-lock-status");c.showModal(a.RequestUnlockConfirmModal({lockCreatedTime:n.ts_locked,lockholderName:n.lockholder_name,onRequestUnlock:function(){w(e,[n])}}))}Object.defineProperty(n,"__esModule",{value:!0}),u=o.__importStar(u);n.unlockSuccessString=m,n.unlockFailureString=d,n.showFeedbackForFileLockAction=_,n.asyncLockFile=h,n.asyncUnlockFile=g,n.asyncRequestUnlockFile=w,n.showFileLockConfirmModal=b,n.showRequestUnlockConfirmModal=v});
//# sourceMappingURL=api.min.js-vfleXwA8N.map