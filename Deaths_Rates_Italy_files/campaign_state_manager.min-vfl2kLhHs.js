define(["require","exports","tslib","modules/core/uri","modules/clean/react/prompt/version","modules/clean/upsell/prompt_event_logger","modules/clean/upsell/prompt_event_emitter"],function(t,e,n,o,r,i,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.PROMPT_CONFIRM_ENDPOINT_URL="/prompt/confirm_v2";var c=(function(){function t(t){var o=this;this.buildConfirmEndpointURI=function(t){if(t=t||o.getConfirmUrlFromContent(),!t||"#"===t)return"#";var n=o.eventLogger.getUpsellControllerURI(e.PROMPT_CONFIRM_ENDPOINT_URL),r=o.component.props.campaign.content.confirmIsPost,i=o.getRedirectURL(t);return i&&n.updateQuery({redirect_url:i}),r&&n.updateQuery({preserve_post:"1"}),n.toString()},this.shouldConfirmUsingPost=function(){var t=o.getConfirmUrlFromContent();return!!(t&&"#"!==t||o.component.props.campaign.content.confirmIsPost)},this.onShow=function(){o.component.state.isShown||(o.component.setState(function(t){return n.__assign({},t,{isShown:!0})}),s.promptBufferedEventEmitter.emit(s.Events.ON_PROMPT_SHOWN,o.component.props.campaign.campaignLocationId),o.eventLogger.triggerExternalEvent("db:prompt:show"),o.eventLogger.recordClientImpression())},this.onConfirm=function(t){o.isAckInProgress()||(o.component.setState(function(t){return n.__assign({},t,{isConfirmed:!0})}),o.eventLogger.triggerExternalEvent("db:prompt:pre-confirm"),o.ensureConfirmIsRecorded(t))},this.isHTMLAnchorElement=function(t){return void 0!==t.href},this.isHTMLFormElement=function(t){return void 0!==t.action},this.onDismiss=function(t,e){o.isAckInProgress()||(o.component.setState(function(t){return n.__assign({},t,{isDismissed:!0})}),t.preventDefault(),s.promptBufferedEventEmitter.emit(s.Events.ON_PROMPT_DISMISSED,o.component.props.campaign.campaignLocationId),o.eventLogger.triggerExternalEvent("db:prompt:pre-dismiss"),o.eventLogger.recordDismiss(e&&e.remindMeLater))},this.enhanceHTMLButtons=function(t,e){var n=void 0===e?{}:e,r=n.confirmButtonSelector,i=void 0===r?".confirm-button":r,s=n.dismissButtonSelector,c=void 0===s?".dismiss-button":s,p=n.onConfirmOverride,m=void 0===p?void 0:p,a=n.onDismissOverride,u=void 0===a?void 0:a;if(t){for(var f=null,g=t.querySelectorAll(i),d=t.querySelectorAll(c),l=0;l<g.length;l++)f=g[l],o.mayEnhanceButton(f)&&(f.href=o.buildConfirmEndpointURI(f.getAttribute("href")),f.target=o.component.props.campaign.content.confirmInNewTab?"_blank":"_self",f.addEventListener("click",m||o.onConfirm));for(var l=0;l<d.length;l++)f=d[l],o.mayEnhanceButton(f)&&f.addEventListener("click",u||o.onDismiss)}},this.component=t,this.eventLogger=new i.PromptEventLogger(this.component.props)}return t.prototype.getConfirmUrlFromContent=function(){var t=this.component.props.campaign.content;return r.isTopNotificationContent(t)?t.buttonUrl:t.confirmUrl},t.prototype.getRedirectURL=function(t){if(t){if(this.component.props.campaign.addTkParams){var e=o.URI.parse(t),n=this.component.props.campaign.versionId;return null==n&&(n=this.component.props.campaign.campaignId),e.updateQuery({_tk:this.component.props.campaign.campaignLocationTkId,_camp:n.toString()}),e.toString()}return t}},t.prototype.ensureConfirmIsRecorded=function(t){if(!this.eventWillRecordConfirm(t)){this.eventLogger.recordConfirm();var e=this.getEventHrefOrAction(t);e&&"#"!==e||t.preventDefault()}},t.prototype.eventWillRecordConfirm=function(t){return(this.getEventHrefOrAction(t)||"").indexOf(e.PROMPT_CONFIRM_ENDPOINT_URL)>-1},t.prototype.getEventHrefOrAction=function(t){var e=null,n=t.currentTarget;return n&&this.isHTMLAnchorElement(n)?e=n.getAttribute("href"):n&&this.isHTMLFormElement(n)&&(e=n.getAttribute("action")),e},t.prototype.mayEnhanceButton=function(t){return!t.classList.contains("prompt-enhanced")&&(t.classList.add("prompt-enhanced"),!0)},t.prototype.isAckInProgress=function(){return this.component.state.isConfirmed||this.component.state.isDismissed},t})();e.CampaignStateManager=c});
//# sourceMappingURL=campaign_state_manager.min.js-vflvxenQs.map