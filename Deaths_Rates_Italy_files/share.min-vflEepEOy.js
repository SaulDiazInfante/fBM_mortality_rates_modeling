define(["require","exports","tslib","react","modules/clean/ajax","modules/clean/filepath","modules/clean/react/browse/constants","modules/clean/react/browse/data/action_creators","modules/clean/react/browse/data/store","modules/clean/react/browse/file_actions/file_action_helpers","modules/clean/react/extensions/data/types","modules/clean/react/extensions/split_share_button_component","modules/clean/react/extensions/utils","modules/clean/react/file_viewer/async_controller","modules/clean/sharing/browse_exports","modules/clean/sharing/constants","modules/clean/web_user_action_events","modules/constants/python","modules/core/browser","modules/core/i18n","modules/core/uri","modules/clean/react/files_view/files_view_logging"],function(e,r,t,n,i,o,a,s,c,l,u,S,_,d,f,h,m,E,p,g,b,A){"use strict";function w(e,r){var t=r.user,n=r.context,a=r.firstFile,u=r.isSearchMode,S=r.useSearchSuccessBanner,_=r.expBrowseSuccessBanner,d=r.isSidebar?m.ActionSurfaceLogValue.RIGHT_SIDEBAR:m.ActionSurfaceLogValue.CENTER_PANE;if(A.logEventWithNumberOfFiles({file:a,user:t,isSearchMode:u,action:m.WebUserActionLogEvent.SHARE,action_source:e.action_source,action_surface:d,extra:e.extra}),l.showRetrievalSuccessBanner(S,u,_,m.WebUserActionLogEvent.SHARE),e.autoShareLink){var E=new b.URI({path:"/sm/create"+o.normalize(a.fq_path)});E.updateQuery("_subject_uid",t.id.toString()),E.updateQuery("redirect","0");var g=function(e){p.redirect(e)};i.WebRequest({url:E.toString(),type:"POST",success:g})}else f.asyncShowShareModal(t,a,{browseContext:n,origin:h.SHARE_ACTION_ORIGIN_TYPE.BROWSE_FILE_ACTIONS},function(e){var r=e.path,t=e.qargs;return c.getStoreForBrowse().dispatch(s.setUrl({path:r,qargs:t}))})}function v(e,r){var t=r.shareItemDisabled,i=r.firstFile,o=r.user,a=r.isSidebar,s=r.isSearchMode,c=r.isViewSmall,l=r.showSplitShare,d=r.isCreateButtonMoveEnabled,f=r.forceSplitShareSecondary,h=r.extensionsFeatureFlags,m=r.sharingServiceInfo,E=r.scrollableSidebarRef,p=r.shouldUsePortalPopover;return a&&!s&&!c&&l&&h&&m&&_.shouldShowSplitShare(h,m,i)?function(){return n.default.createElement(S.SplitShareButton,{file:i,user:o,variant:d&&f?"secondary":"primary",triggerType:u.TriggerType.SidebarPrimaryButton,onShowShare:I(e),onDropdownOpen:F(e),logShareButtonClick:T(e),onPresentInZoom:L(e),context:{surface:s?"search":"browse"},scrollableSidebarRef:E,shouldUsePortalPopover:p})}:c?{label:g._("Share link"),performAction:V(e),disabled:t,className:"action-share-link",iconName:"link",key:"share-link"}:{label:g._("Share"),iconName:"link",performAction:y(e),disabled:t,className:"action-share",key:"share"}}var R=this;Object.defineProperty(r,"__esModule",{value:!0}),n=t.__importDefault(n),i=t.__importStar(i),o=t.__importStar(o),p=t.__importStar(p);var V=function(e){return function(){w({autoShareLink:!1,action_source:e.isSidebar?m.ActionSourceValue.SHARE:m.ActionSourceValue.OVERFLOW_MENU},e)}},y=function(r){var n=r.isSidebar?m.ActionSourceValue.SHARE:m.ActionSourceValue.OVERFLOW_MENU,i=function(){return w({autoShareLink:!1,action_source:n},r)};return function(){return t.__awaiter(R,void 0,void 0,function(){var n,o,a;return t.__generator(this,function(s){switch(s.label){case 0:return i(),r.isSidebar?[4,new Promise(function(r,t){e(["modules/clean/react/app_actions/telemetry_client"],r,t)}).then(t.__importStar)]:[2];case 1:return n=s.sent(),o=n.createTelemetryClient,a=n.getPiiSafeExtension,o({component:"share-btn"}).session({surface:r.isSearchMode?"search":"browse",ext:a(r.firstFile.ext)}).event("click_share",{trigger_type:u.TriggerType.SidebarPrimaryButton}),[2]}})})}},I=function(e){return function(){w({autoShareLink:!1,action_source:m.ActionSourceValue.SPLIT_SHARE},e)}},T=function(e){return function(r){var t=e.isSidebar?m.ActionSurfaceLogValue.RIGHT_SIDEBAR:m.ActionSurfaceLogValue.CENTER_PANE;l.logUserEventOnFile({result:e.firstFile,args:e,action_type:m.WebUserActionLogEvent.SHARE,action_source:m.ActionSourceValue.SPLIT_SHARE,action_surface:t,extra:{splitshare_option:r}})}},F=function(e){return function(){var r=e.isSidebar?m.ActionSurfaceLogValue.RIGHT_SIDEBAR:m.ActionSurfaceLogValue.CENTER_PANE;l.logUserEventOnFile({result:e.firstFile,args:e,action_type:m.WebUserActionLogEvent.OPEN_SPLITSHARE,action_source:m.ActionSourceValue.SPLIT_SHARE,action_surface:r})}},L=function(e){return function(){d.asyncOpenPreview({containerId:a.BROWSE_FILE_VIEWER_ELEMENT_ID,files:[e.firstFile],indexOfPreviewFile:0,shouldFocusComment:!1,user:e.user,onFileViewerDidMount:d.hideElementsBehindFileViewer,onFileViewerUnmount:d.showElementsBehindFileViewer,fileViewAction:E.FileViewActionType.CLICK,fileViewOrigin:E.FileViewOriginType.BROWSE,fileViewTarget:E.FileViewTargetType.PRIVATE,shouldPresentInZoom:!0})}};r.getShareItem=v});
//# sourceMappingURL=share.min.js-vflPt3W6S.map