define(["require","exports","tslib","modules/clean/react/file_transfers/lib/api","external/lodash","modules/clean/display_format","modules/clean/downloads","modules/clean/react/file_transfers/redux/types","modules/clean/react/file_transfers/uploader/types","modules/clean/react/file_transfers/constants","modules/clean/filepath","modules/clean/uuid","modules/core/i18n","file-transfers/common/constants","file-transfers/common/types"],function(e,t,n,r,o,a,i,l,s,u,c,f,d,m,p){"use strict";function h(e){return{recipient:{".tag":"email_address",email_address:e.email}}}function _(e){return e.slice().sort(function(e,t){return e.creation_time<t.creation_time?1:t.creation_time<e.creation_time?-1:0})}function g(e,t){return void 0===t&&(t={}),void 0===t.numDecimalPlaces&&(e<a.SWITCH_UNIT_THRESHOLD*m.BYTES_IN_KILOBYTE?t.numDecimalPlaces=0:e<a.SWITCH_UNIT_THRESHOLD*m.BYTES_IN_MEGABYTE?t.numDecimalPlaces=1:t.numDecimalPlaces=2),a.format_bytes(e,t.numDecimalPlaces,t.includeSpace,t.lazy,t.allowNegative)}function S(e){return u.VALID_EMAIL_REGEX.test(e.email)}function v(e){var t=E(e);t?D(e,t+1):D(e,1)}function E(e){var t=localStorage.getItem(e);return null===t?null:parseInt(t,10)}function F(e){var t=localStorage.getItem(e);return null===t?null:"true"===t}function D(e,t){localStorage.setItem(e,t.toString())}function T(e){return null!==sessionStorage.getItem("fileTransferAtLeastOneFileDownloaded:"+e)}function y(e){sessionStorage.setItem("fileTransferAtLeastOneFileDownloaded:"+e,"true")}function I(){return null!==localStorage.getItem("fileTransferEverSetBackground")}function A(){localStorage.setItem("fileTransferEverSetBackground","true")}function C(){return null!==localStorage.getItem("fileTransferHasEverSetLogo")}function w(){localStorage.setItem("fileTransferHasEverSetLogo","true")}function b(e,t){return L(e.summary_file_names,e.display_file_count,t)}function L(e,t,n){return 0===e.length?d._("Transfer with no items",{comment:"title of transfer when there are no files or folders in it"}):t<=1?d._("%(item_name)s",{comment:"Name of the first file or folder in a file transfer"}).format({item_name:n?N(e[0]):e[0]}):d._("%(item_name)s + %(item_count)d",{comment:"Name of the first file or folder in a file transfer and how many others are in the transfer"}).format({item_name:n?N(e[0]):e[0],item_count:t-1})}function N(e){var t=e;if(e.length>u.MAX_LEN_OF_FILE_NAME){t=e.slice(0,u.LEN_OF_FILE_NAME_PREFIX)+"..."+e.slice(e.length-u.LEN_OF_FILE_NAME_SUFFIX)}return t}function U(e,t,n){return void 0===n&&(n=s.FileRole.Content),{id:f.UUID.v4(),isDir:!0,path:e,size:0,source:t,role:n,thumbnailUrl:null}}function k(e,t){return void 0===t&&(t=s.FileRole.Content),{id:e.transfer_file_id,isDir:e.obsolete_is_dir,path:e.relative_path,size:e.file_size,source:s.FileSource.Transfer,role:t,thumbnailUrl:e.thumbnail_url||null}}function P(e,t){var n=e.id,r=e.isDir,o=e.name,a=e.bytes;return void 0===t&&(t=s.FileRole.Content),{id:n,isDir:r,path:o,size:a,source:s.FileSource.Dropbox,role:t,thumbnailUrl:null}}function O(e,t){return void 0===t&&(t=s.FileRole.Content),{id:e.id,isDir:0===e.size,path:e.dest,size:e.size,source:s.FileSource.Computer,role:t,thumbnailUrl:null}}function x(e,t){return void 0===t&&(t=s.FileRole.Content),{path:e.name,id:e.name,size:e.size||0,isDir:!1,source:s.FileSource.Computer,thumbnailUrl:null,role:t}}function R(e,t){return void 0===t&&(t={}),n.__assign({id:e.id,isDir:e.isDir,name:e.path,size:e.size,thumbnailUrl:e.thumbnailUrl},t)}function B(e){return e.reduce(function(e,t){return e+t.size},0)}function Y(e,t){return void 0===t&&(t=s.FileRole.Content),{id:f.UUID.v4(),isDir:!0,path:e.fullPath?e.fullPath.substring(1):e.name,size:0,source:s.FileSource.Computer,role:t,thumbnailUrl:null}}function M(e){return null===z(e)}function z(e){var t;if("dest"in e)t=e.dest;else if("fullPath"in e){if(!e.fullPath)return null;t=e.fullPath,"/"===t.charAt(0)&&(t=e.fullPath.substring(1))}else{if(!("path"in e))throw new Error("file must be either PluploadFile, StateFileInfo, or FileSystemEntry");if(!e.path)return null;t=e.path}var n=t.split("/");return n.length<=1?null:n[0]}function V(e){return e?e:u.NULL_FILE_TRANSFER_KEY}function H(e){return e.isDir&&e.source===s.FileSource.Computer}function K(e,t){void 0===t&&(t={});for(var n=document.getElementsByName("file-downloads-iframe"),r=0,o=Array.from(n);r<o.length;r++){var a=o[r];a&&a.parentNode&&a.parentNode.removeChild(a)}var i=document.createElement("iframe");i.name="file-downloads-iframe",i.src="about:blank",i.setAttribute("style","display: none;"),document.body.appendChild(i);var l=i.contentDocument,s=l.createElement("form");s.action=e,s.method="post",Object.keys(t).forEach(function(e){var n=document.createElement("input");n.type="hidden",n.name=e,n.value=t[e],s.appendChild(n)}),l.body.appendChild(s),s.submit()}function W(e,t,o){return n.__awaiter(this,void 0,Promise,function(){var a;return n.__generator(this,function(n){return a=r.downloadFiles(t,e,o),a.then(function(e){var t=e.post_params?JSON.parse(e.post_params):{},n=e.url.toString();0===Object.keys(t).length?i.get({url:n}):K(n,t)}),a.catch(function(e){}),[2,a]})})}function X(e,t){void 0===t&&(t=[]);var r=[],o=[],a=new Set,i=new Set;return t.filter(function(e){return M(e)}).forEach(function(e){a.add(e.id),i.add(e.path.toLowerCase())}),e.forEach(function(e){var t,l,s=c.split_filename(e.path);if(i.has(e.path.toLowerCase())){if(a.has(e.id))return;var u=1,f=void 0;do f=s.name+" ("+u+")",t=s.ext?f+"."+s.ext:f,u++;while(i.has(t.toLowerCase()));a.add(e.id),i.add(t.toLowerCase()),l=n.__assign({},e,{path:t}),r.push(l)}else M(e)?(a.add(e.id),i.add(e.path.toLowerCase()),l=n.__assign({},e)):l=n.__assign({},e);o.push(l)}),{files:o,filesRenamed:r}}function j(e,n){return Math.floor((n.getTime()-e.getTime())/t.DAYS_IN_MS)}function G(e,t){var n=j(new Date(e.getFullYear(),e.getMonth(),e.getDate()),new Date(t.getFullYear(),t.getMonth(),t.getDate()));switch(n){case p.ExpirationOption.THREE_DAYS:case p.ExpirationOption.SEVEN_DAYS:case p.ExpirationOption.THIRTY_DAYS:case p.ExpirationOption.NINETY_DAYS:return n;default:return p.ExpirationOption.CUSTOM}}function q(e){switch(e){case l.UpsellVariant.TRY_PROFESSIONAL:return{productName:"Professional",ctaCopy:d._("Try Professional free",{comment:"text on a CTA button or a link for upselling. The CTA asks user to try using Dropbox Professional Individual Plan for free."}),ctaLink:"https://www.dropbox.com/pro/try"};case l.UpsellVariant.BUY_PROFESSIONAL:return{productName:"Professional",ctaCopy:d._("Try Professional",{comment:"text on a CTA button or a link for upselling. The CTA asks user to upgrade to Dropbox Professional Individual Plan."}),ctaLink:"https://www.dropbox.com/buy/professional"};case l.UpsellVariant.TRY_BUSINESS_ADVANCED:return{productName:"Advanced",ctaCopy:d._("Try Business Advanced free",{comment:"text on a CTA button or a link for upselling. The CTA asks user to try using Dropbox Advanced Business Plan for free."}),ctaLink:"https://www.dropbox.com/business/try"};case l.UpsellVariant.CONTACT_ADMIN:return{productName:"Advanced",ctaCopy:d._("Contact admin",{comment:"text on a CTA button or a link for upselling. The CTA asks user to contact their team admin."}),ctaLink:"https://www.dropbox.com/team#members"}}}function J(e){return e.value?e.value[".tag"]:"other"}function Z(e){return function(t){return J(t)===e}}function Q(e){return!!e.color_hex&&!e.asset}function $(e){return!!e.asset&&se(e.asset)}function ee(e){return!!e.asset&&ue(e.asset)}function te(e){return $(e)?e.asset.value:null}function ne(e){return ee(e)?e.asset.value:null}function re(){return f.UUID.v4()}function oe(e,t){return t?o.filter(t,function(t){return t.status===e}).length:0}function ae(e,t){if(!e.isDir)throw Error("Can only get children of a directory");return t.filter(function(t){return t.path!==e.path&&t.path.startsWith(e.path+"/")})}function ie(e,t){return e.every(function(e){return t[e.id]&&t[e.id].status===s.UploadStatus.Success})}function le(e,t){var n=function(e){return Date.UTC(e.getFullYear(),e.getMonth(),e.getDate())},r=n(t)-n(e);return new Date(+e+r)}Object.defineProperty(t,"__esModule",{value:!0}),r=n.__importStar(r),i=n.__importStar(i),t.contactToFileTransfersEmailRecipient=h,t.sortByCreationTimeDesc=_,t.formatBytes=g,t.hasValidEmail=S,t.incrementLocalStorageValueForKey=v,t.getLocalStorageNumberValueForKey=E,t.getLocalStorageBooleanValueForKey=F,t.setLocalStorageValueForKey=D,t.hasAtLeastOneFileDownloaded=T,t.markAtLeastOneFileDownloaded=y;t.hasEverSetBackground=I,t.markHasEverSetBackground=A;t.hasEverSetLogo=C,t.markHasEverSetLogo=w,t.generateTransferSummaryTitle=b,t.generateTransferTitle=L,t.formatLongFileNameForDisplay=N,t.createDirectoryStateFileInfo=U,t.transferFileAsStateFileInfo=k,t.chooserFileAsStateFileInfo=P,t.pluploadFileAsStateFileInfo=O,t.fileAsStateFileInfo=x,t.stateFileInfoAsFileInfo=R,t.sumBytes=B,t.fileSystemDirectoryEntryAsStateFileInfo=Y,t.isAtRoot=M,t.getRootDirectory=z,t.getTransferFilesKey=V,t.isLocalDirectory=H,t.downloadZipFromUrl=K,t.downloadFiles=W,t.renameDuplicateFiles=X,t.DAYS_IN_MS=864e5,t.getDateDiff=j,t.estimateExpirationOption=G,t.getUpsellProps=q;var se=Z("image"),ue=Z("video");t.isColorBackground=Q,t.isImageBackground=$,t.isVideoBackground=ee,t.getImageBackgroundAsset=te,t.getVideoBackgroundAsset=ne,t.generateTransferTrackingId=re,t.numWaiting=function(e){return oe(s.UploadStatus.Waiting,e)},t.numSuccess=function(e){return oe(s.UploadStatus.Success,e)},t.getChildrenFiles=ae,t.areItemsUploaded=ie,t.computeCreationRelativeExpirationDate=le});
//# sourceMappingURL=utils.min.js-vflqyooa8.map